
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Sistema de Taxis Distribuido</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-value { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .status-healthy { color: #27ae60; }
        .status-warning { color: #f39c12; }
        .status-degraded { color: #e74c3c; }
        .status-down { color: #8b0000; }
        .status-unknown { color: #7f8c8d; }
        .refresh-btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .refresh-btn:hover { background: #2980b9; }
        .timestamp { color: #7f8c8d; font-size: 0.9em; }
        .config-info { background: #ecf0f1; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöï Monitor Sistema de Taxis Distribuido</h1>
            <button class="refresh-btn" onclick="updateStats()">üîÑ Actualizar</button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìä Estado del Sistema</h3>
                <div id="system-health" class="stat-value">Cargando...</div>
                <div id="last-update" class="timestamp"></div>
            </div>
            
            <div class="stat-card">
                <h3>üë• Usuarios OpenFire</h3>
                <div class="stat-value">
                    <span id="online-users">0</span> / <span id="total-users">0</span>
                </div>
                <div>En l√≠nea / Total</div>
            </div>
            
            <div class="stat-card">
                <h3>üéØ Coordinador</h3>
                <div id="coordinator-count" class="stat-value">0</div>
                <div>Instancias activas</div>
            </div>
            
            <div class="stat-card">
                <h3>üöñ Hosts de Taxis</h3>
                <div id="taxi-hosts-count" class="stat-value">0</div>
                <div>Hosts conectados</div>
            </div>
            
            <div class="stat-card">
                <h3>üë• Hosts de Pasajeros</h3>
                <div id="passenger-hosts-count" class="stat-value">0</div>
                <div>Hosts conectados</div>
            </div>
        </div>
        
        <div class="config-info">
            <h3>‚öôÔ∏è Configuraci√≥n OpenFire</h3>
            <div id="openfire-config">Cargando configuraci√≥n...</div>
        </div>
    </div>

    <script>
        function updateStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    // Estado del sistema
                    const healthElement = document.getElementById('system-health');
                    healthElement.textContent = getHealthText(data.system_health);
                    healthElement.className = 'stat-value status-' + data.system_health;
                    
                    // Usuarios
                    document.getElementById('online-users').textContent = data.online_users;
                    document.getElementById('total-users').textContent = data.total_users;
                    
                    // Hosts
                    document.getElementById('coordinator-count').textContent = data.hosts.coordinator || 0;
                    document.getElementById('taxi-hosts-count').textContent = data.hosts.taxi_hosts || 0;
                    document.getElementById('passenger-hosts-count').textContent = data.hosts.passenger_hosts || 0;
                    
                    // Timestamp
                    document.getElementById('last-update').textContent = 
                        '√öltima actualizaci√≥n: ' + new Date(data.timestamp).toLocaleString();
                    
                    // Configuraci√≥n OpenFire
                    document.getElementById('openfire-config').innerHTML = 
                        `<strong>Host:</strong> ${data.openfire_config.host}:${data.openfire_config.port}<br>
                         <strong>Dominio:</strong> ${data.openfire_config.domain}`;
                })
                .catch(error => {
                    console.error('Error actualizando estad√≠sticas:', error);
                    document.getElementById('system-health').textContent = 'Error de conexi√≥n';
                    document.getElementById('system-health').className = 'stat-value status-unknown';
                });
        }
        
        function getHealthText(health) {
            const healthTexts = {
                'healthy': '‚úÖ Saludable',
                'warning': '‚ö†Ô∏è Advertencia',
                'degraded': 'üî∏ Degradado',
                'down': '‚ùå Inactivo',
                'unknown': '‚ùì Desconocido'
            };
            return healthTexts[health] || '‚ùì Desconocido';
        }
        
        // Actualizar cada 5 segundos
        setInterval(updateStats, 5000);
        
        // Actualizaci√≥n inicial
        updateStats();
    </script>
</body>
</html>
